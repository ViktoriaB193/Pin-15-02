<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>–†–ê–°–°–ö–†–ê–°–ö–ê –ü–û –û–¢–í–ï–¢–ê–ú ‚Äî –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –†–µ–¥–∞–∫—Ç–æ—Ä</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

<style>
  :root { 
    --bg: #050817; --panel: #0b1126; --text: #f1f5f9; 
    --primary: #c084fc; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –Ω–µ–æ–Ω */
    --accent: #38bdf8; --line: #1e293b;
  }
  body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: grid; grid-template-columns: 420px 1fr; }
  
  /* –í–µ—Ä—Ö–Ω–∏–π —Å—Ç–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
  .header-main { 
    grid-column: 1 / -1; height: 80px; background: #020617; 
    display: flex; align-items: center; justify-content: center; gap: 20px;
    border-bottom: 2px solid var(--primary); box-shadow: 0 0 15px rgba(192, 132, 252, 0.4);
  }
  .header-main h1 {
    font-size: 32px; font-weight: 900; color: #fff; margin: 0;
    text-transform: uppercase; letter-spacing: 3px;
    text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary);
  }
  .logo-img { height: 60px; border-radius: 50%; border: 2px solid var(--primary); }

  /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
  .sidebar { background: var(--panel); border-right: 1px solid var(--line); display: flex; flex-direction: column; overflow-y: auto; padding: 20px; }
  .section { margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid var(--line); }
  h3 { margin: 0 0 12px; font-size: 12px; text-transform: uppercase; color: var(--accent); letter-spacing: 1px; }
  
  input, textarea, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--line); background: #161e3d; color: #fff; margin-bottom: 10px; box-sizing: border-box; }
  .btn { width: 100%; padding: 12px; border-radius: 8px; border: 0; cursor: pointer; font-weight: bold; transition: 0.2s; background: var(--primary); color: #000; margin-top: 5px; }
  .btn:hover { transform: scale(1.02); filter: brightness(1.2); }

  /* –•–æ–ª—Å—Ç */
  .canvas-area { display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #0f172a 0%, #020617 100%); position: relative; padding: 40px; }
  .frame { position: relative; line-height: 0; border: 3px solid var(--primary); border-radius: 10px; box-shadow: 0 0 30px rgba(192, 132, 252, 0.2); }
  #mainImg { max-width: 100%; max-height: 70vh; display: block; pointer-events: none; }
  #mainSvg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: crosshair; }

  /* –ü–æ–¥–ø–∏—Å—å –≤–Ω–∏–∑—É */
  .footer-credit { position: absolute; bottom: 10px; right: 20px; font-size: 14px; opacity: 0.8; font-weight: bold; color: var(--accent); }
  
  .list-item { background: #161e3d; padding: 10px; border-radius: 8px; margin-bottom: 5px; border: 1px solid var(--line); font-size: 13px; }
</style>
</head>
<body>

<div class="header-main">
  <img src="https://i.ibb.co/q345VSpm/5291888536539828600.jpg" class="logo-img" alt="–õ–µ–π–±–ª">
  <h1>–†–ê–°–°–ö–†–ê–°–ö–ê –ü–û –û–¢–í–ï–¢–ê–ú</h1>
</div>

<div class="sidebar">
  <div class="section">
    <h3>1. –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∏ –°—Ç–∏–ª—å</h3>
    <select id="imgPreset" onchange="loadPreset()">
      <option value="">-- –í—ã–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—É—é --</option>
      <option value="https://i.ibb.co/jvj9q36b/c8fae767598537c00255e117f9b1199b.jpg">–ú–∏–ª—ã–π –µ–¥–∏–Ω–æ—Ä–æ–≥</option>
      <option value="https://i.ibb.co/GqxzQ5c/2026-02-16-234253.png">–°–æ–≤—É–Ω—å—è (–°–º–µ—à–∞—Ä–∏–∫–∏)</option>
      <option value="https://i.ibb.co/XZfDj366/2026-02-16-234445.png">–ë–∞—Ä–±–æ—Å–∫–∏–Ω—ã</option>
      <option value="https://i.ibb.co/ch9R8Lbd/Avatar-Jake-Sully-and-Neytiri.png">–ê–≤–∞—Ç–∞—Ä</option>
    </select>
    <input type="file" id="fileInp" accept="image/*">
    <div style="display:flex; gap:10px;">
      <div><label style="font-size:10px;">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label><input type="color" id="fontColor" value="#ffffff"></div>
      <div><label style="font-size:10px;">–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label><input type="color" id="glowColor" value="#c084fc"></div>
    </div>
  </div>

  <div class="section">
    <h3>2. –û–±–≤–æ–¥–∫–∞ –∏ –ó–∞–¥–∞–Ω–∏–µ</h3>
    <label style="font-size:11px;">–í–æ–ø—Ä–æ—Å (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç LaTeX: \frac{1}{2}, \sqrt{x}):</label>
    <textarea id="taskInp" placeholder="–ù–∞–ø—Ä: \frac{10}{2} –∏–ª–∏ Choose 'Apple'"></textarea>
    <input type="text" id="ansInp" placeholder="–í–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç">
    <div style="display:flex; align-items:center; gap:10px;">
      <label style="font-size:11px;">–¶–≤–µ—Ç:</label><input type="color" id="colorInp" value="#ff4d6d">
      <button class="btn" style="background:#475569; color:#fff; margin:0;" onclick="undoPoint()">–ù–∞–∑–∞–¥</button>
    </div>
    <button class="btn" onclick="saveRegion()">–°–û–•–†–ê–ù–ò–¢–¨ –û–ë–õ–ê–°–¢–¨</button>
  </div>

  <div class="section">
    <h3>3. –°–ø–∏—Å–æ–∫</h3>
    <div id="regList"></div>
  </div>

  <div class="section">
    <h3>4. –≠–∫—Å–ø–æ—Ä—Ç</h3>
    <button class="btn" style="background:var(--accent)" onclick="buildGame()">–°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ò–ì–†–£</button>
    <textarea id="output" style="height:60px; font-size:10px; margin-top:10px;" readonly></textarea>
    <div style="font-size:11px; color:#aaa; margin-top:10px;">–£—Ä–æ–∫–∏ –Ω–∞ –í–°–ï —Å–ª—É—á–∞–∏ ‚Ä¢ Genially</div>
  </div>
</div>

<div class="canvas-area">
  <div class="frame" id="frameBox">
    <img id="mainImg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
    <svg id="mainSvg" viewBox="0 0 1000 1000" preserveAspectRatio="none"></svg>
  </div>
  <div class="footer-credit">–£—Ä–æ–∫–∏ –Ω–∞ –í–°–ï —Å–ª—É—á–∞–∏ ‚Ä¢ Genially</div>
</div>

<script>
  let points = []; let regions = []; let currentImg = "";

  function loadPreset() {
    const url = document.getElementById('imgPreset').value;
    if(url) { currentImg = url; document.getElementById('mainImg').src = url; }
  }

  document.getElementById('fileInp').onchange = (e) => {
    const reader = new FileReader();
    reader.onload = (ev) => { currentImg = ev.target.result; document.getElementById('mainImg').src = ev.target.result; };
    reader.readAsDataURL(e.target.files[0]);
  };

  document.getElementById('mainSvg').onclick = (e) => {
    const rect = e.target.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 1000;
    const y = ((e.clientY - rect.top) / rect.height) * 1000;
    points.push({x, y}); draw();
  };

  function draw() {
    let h = '';
    if(points.length > 0) {
      const path = points.map(p => `${p.x},${p.y}`).join(' ');
      h += `<polyline points="${path}" fill="none" stroke="#fff" stroke-width="2" stroke-dasharray="5,5" />`;
    }
    regions.forEach(r => {
      const path = r.points.map(p => `${p.x},${p.y}`).join(' ');
      h += `<polygon points="${path}" fill="${r.color}44" stroke="${r.color}" stroke-width="1" />`;
    });
    document.getElementById('mainSvg').innerHTML = h;
  }

  function undoPoint() { points.pop(); draw(); }

  function saveRegion() {
    const task = document.getElementById('taskInp').value;
    const ans = document.getElementById('ansInp').value;
    const color = document.getElementById('colorInp').value;
    if(!task || !ans || points.length < 3) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–ª–∞—Å—Ç–∏");
    regions.push({ task, answer: ans, color, points: [...points] });
    points = []; updateList(); draw();
  }

  function updateList() {
    document.getElementById('regList').innerHTML = regions.map((r,i) => `
      <div class="list-item">–û–±–ª–∞—Å—Ç—å #${i+1} (${r.answer}) <button onclick="regions.splice(${i},1);updateList();draw()" style="float:right;background:none;border:0;color:red;cursor:pointer">‚úñ</button></div>
    `).join('');
  }

  function buildGame() {
    const cfg = {
      glow: document.getElementById('glowColor').value,
      fColor: document.getElementById('fontColor').value,
      img: currentImg,
      data: regions
    };

    const finalHtml = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <style>
    body { margin: 0; background: transparent; font-family: 'Segoe UI', sans-serif; height: 100vh; display: grid; grid-template-columns: 40% 60%; color: ${cfg.fColor}; overflow: hidden; }
    .side { padding: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    #q-box { background: rgba(0,0,0,0.4); padding: 25px; border-radius: 20px; text-align: center; border: 2px solid ${cfg.glow}; width: 80%; }
    .frame { position: relative; border: 4px solid ${cfg.glow}; box-shadow: 0 0 25px ${cfg.glow}; border-radius: 15px; background: #000; overflow: hidden; }
    img { max-width: 100%; max-height: 75vh; display: block; }
    svg { position: absolute; top:0; left:0; width:100%; height:100%; }
    input { width: 100%; padding: 12px; margin: 15px 0; border-radius: 10px; border: 0; font-size: 18px; text-align: center; }
    .btn-check { background: ${cfg.glow}; color: #000; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: bold; border:0; }
    .progress-bar { width: 100%; height: 10px; background: rgba(255,255,255,0.1); margin-top: 20px; border-radius: 5px; overflow: hidden; }
    #progress-inner { height: 100%; background: ${cfg.glow}; width: 0%; transition: 0.5s; }
    .paint-can { width: 60px; height: 60px; border-radius: 50%; border: 3px solid #fff; margin-top: 20px; display: none; cursor: pointer; animation: bounce 1s infinite; }
    @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
  </style>
</head>
<body>
  <div class="side">
    <div id="q-box">
      <div id="math-field" style="font-size: 28px;"></div>
      <input type="text" id="userAns" placeholder="–û—Ç–≤–µ—Ç...">
      <button class="btn-check" onclick="checkAnswer()">–ü–†–û–í–ï–†–ò–¢–¨</button>
      <div id="feedback" style="margin-top: 10px; height: 20px;"></div>
      <div id="p-can" class="paint-can" onclick="enablePainting()"></div>
      <div class="progress-bar"><div id="progress-inner"></div></div>
    </div>
  </div>
  <div class="side"><div class="frame"><img src="${cfg.img}"><svg id="gSvg"></svg></div></div>

  <script>
    const data = ${JSON.stringify(cfg.data)};
    let curIdx = 0; let canPaint = false; let solved = [];

    function renderTask() {
      const q = data[curIdx];
      const field = document.getElementById('math-field');
      if(q.task.includes('\\\\') || q.task.includes('^')) {
        katex.render(q.task, field);
      } else { field.textContent = q.task; }
      document.getElementById('userAns').value = '';
      document.getElementById('p-can').style.display = 'none';
      canPaint = false;
    }

    function checkAnswer() {
      const user = document.getElementById('userAns').value.trim().toLowerCase();
      const correct = data[curIdx].answer.toLowerCase();
      if(user === correct) {
        document.getElementById('feedback').textContent = '‚úÖ –í–µ—Ä–Ω–æ! –•–≤–∞—Ç–∞–π –∫—Ä–∞—Å–∫—É!';
        document.getElementById('p-can').style.backgroundColor = data[curIdx].color;
        document.getElementById('p-can').style.display = 'inline-block';
      } else { document.getElementById('feedback').textContent = '‚ùå –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑'; }
    }

    function enablePainting() { 
      canPaint = true; 
      document.getElementById('feedback').textContent = 'üé® –ö–ª–∏–∫–∞–π –Ω–∞ –Ω–æ–º–µ—Ä ' + data[curIdx].answer + ' –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ!';
    }

    function drawImg() {
      document.getElementById('gSvg').innerHTML = data.map((r, i) => {
        const isS = solved.includes(i);
        const center = { x: r.points.reduce((s,p)=>s+p.x,0)/r.points.length, y: r.points.reduce((s,p)=>s+p.y,0)/r.points.length };
        return \`<polygon points="\${r.points.map(p=>p.x+','+p.y).join(' ')}" fill="\${isS ? r.color : '#fff'}" stroke="#ccc" />
                \${!isS ? \`<text x="\${center.x}" y="\${center.y}" font-size="25" font-weight="bold" text-anchor="middle" dominant-baseline="middle" onclick="clickReg(\${i})" style="cursor:pointer">\${r.answer}</text>\` : ''}\`;
      }).join('');
    }

    window.clickReg = (i) => {
      if(!canPaint || i !== curIdx) return;
      solved.push(i);
      curIdx++;
      document.getElementById('progress-inner').style.width = (solved.length / data.length * 100) + '%';
      if(curIdx < data.length) { renderTask(); drawImg(); document.getElementById('feedback').textContent = ''; }
      else { document.getElementById('q-box').innerHTML = '<h2>–ü–û–ë–ï–î–ê! üéâ</h2>'; drawImg(); }
    };

    renderTask(); drawImg();
  <\/script>
</body>
</html>`;

    document.getElementById('output').value = `<iframe srcdoc="${finalHtml.replace(/"/g, '&quot;')}" width="100%" height="600" style="border:0;" allowtransparent="true"></iframe>`;
    alert("–ö–æ–¥ –≥–æ—Ç–æ–≤! –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –∏–∑ –Ω–∏–∂–Ω–µ–≥–æ –ø–æ–ª—è.");
  }
</script>
</body>
</html>
